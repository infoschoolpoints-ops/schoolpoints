# רשימת מטלות - SchoolPoints 📋

## מטלות שהושלמו לאחרונה ✅

### אופטימיזציות ביצועים (ינואר 2026) ✅
- [x] צמצום לוגים ואתחולים מיותרים בעמדה הציבורית (לוגים דיבוג לפי דגל בלבד)
- [x] אופטימיזציה לסריקות צלילים (marker לקאש + cache לרשימת צלילים)
- [x] אתחול עצל ל-SoundManager בעמדת ניהול
- [x] חיבור עצל/אסינכרוני למסך לקוח בעמדת קופה

### חדשות מתוזמנות (Scheduled News) ✅
- [x] הוספת שדות `start_date` ו-`end_date` לטבלת `news_items`
- [x] עדכון פונקציות ב-`messages.py` לתמיכה בתאריכים
- [x] עדכון ממשק ניהול החדשות ב-`messages_manager.py`
- [x] הוספת עמודת "תאריכי תזמון" לטבלה
- [x] תמיכה בפורמט DD.MM.YYYY בממשק
- [x] סינון אוטומטי של חדשות לפי תאריכים ב-`get_active_news_items()`

### רישיון חודשי (Monthly License)
- [x] הוספת שדה `expiry_date` למבנה הרישיון
- [x] יצירת פונקציה `_make_monthly_license_key()` עם סכמה SP3
- [x] יצירת פונקציה `validate_monthly_license_key()`
- [x] תמיכה ב-3 רמות: BASIC, EXTENDED, UNLIMITED
- [x] **עדכון ממשק הרישום ב-`admin_station.py`**

### ייצוא והצגה (סשן קודם) ✅
- [x] הוספת RTL וצבעים מתחלפים לכל ייצואי Excel
- [x] תיקון ייצוא רכישות מוצרים (מי קנה מה וכמה)
- [x] הוספת ייצוא תורנות אתגרים (לפי אתגר או כולם)
- [x] תיקון גדלי חלונות דיאלוג והפיכתם ל-resizable
- [x] הוספת אפשרות תצוגה מקדימה לייצואים

---

## מטלות ממתינות - עדיפות גבוהה 🔴

### חדש (ינואר 2026) – דרישות נוספות
- [x] **פריטיות מלאה לכל מסכי ניהול בווב** – תלמידים | ניהול מורים | דוחות | תצוגה ותוכן | הגדרות תצוגה (צבעים/צלילים/מטבעות) | הודעות | בונוס מיוחד | בונוס זמנים | בונוסים | חגים/חופשות | מערכת | הגדרות מערכת | לוגים | שדרוגים (שמות/פונקציונליות כמו במקומי)
  - [x] טבלת השוואה מלאה בין פעולות במקומי לבין ה‑Web (בדיקת חוסרים ותיקון)
- [x] **גרפיקה אחידה לכל המסכים** – הדר/פוטר, כפתורים בעיצוב אחיד עם אייקונים
  - [x] יצירת סט אייקונים לכל שורת פעולה/כפתור בממשק הווב
- [x] **אזור אישי מלא + שמירת התחברות** – הישארות מחובר עד יציאה, תפריט מוסד מלא
- [x] **סופר אדמין (ווב)** – ניהול כל המוסדות, עריכה מלאה, כניסה למוסד ללא סיסמה, רישום מוסדות
- [ ] **תיקון “עדכון מהיר”** – מודאל נפתח במרכז בלי גלילה + התאמת צבעים/נראות טקסט
- [ ] **מדריך/הורדה באתר** – החזרת דף מדריך/הורדה לפעולה תקינה
  - [ ] העלאת `guide_user_embedded.html` העדכני מהתוכנה המקומית + קישור ל"ציוד נדרש"
  - [ ] חיבור תמונות המדריך מתיקיית `תמונות/להוראות` והצגתן דרך /web/assets
- [ ] **מחשב חדש: חיבור לענן + סנכרון מלא של הגדרות/נתונים מקומיים** – הורדה מהענן + יצירת DB מקומי + סנכרון הגדרות/תצוגה/קופה
- [ ] **עקיפת לוגים תקועים ב־DO** – להחזיר שגיאת traceback בדף /web/students באופן זמני כדי לקבל שגיאה גם בלי Runtime Logs
- [ ] **דיאגנוסטיקה 500 ב־/web/students (לוג זמני לפרוד)** – להעלות לוג זמני לשרת כדי לקבל traceback
- [x] **תיקון ידני של זמן תיקוף/הגעה** – כפתור במסך ניהול תלמיד לבחירת תאריך+שעה, רישום כאילו תיקף בזמן הנבחר, כולל החלת בונוס זמנים וייצוא בהתאם.
- [x] **ניהול קופה: רענון מיידי אחרי שמירת מוצר/אתגר** – לאחר הוספה/עריכה, הרשימה תתעדכן מיידית בלי צורך לסגור/לפתוח את חלון הניהול.
- [x] **מסך קופה: גלילה עם אצבע/Touch** – גלילה לרשימת המוצרים ולעגלת הקניות גם ב-touch/trackpad (כיום רק גלגלת עכבר).
- [x] **רקע עמדה ציבורית: תיקון מונטאז' תמונות** – לתקן פריסת מונטאז' רקע כך שלא יהיו חללים שחורים גדולים בין תמונות.
- [x] **חשבונית/שובר: תאריך עברי** – להוסיף הדפסה של תאריך עברי בחשבונית ובשובר (כרגע לא מודפס).
- [x] **מערכת "מקסימום נקודות"** – הגדרות מערכת + חישוב תקרה נוכחית + אכיפה (אזהרה/חסימה) בעת הוספת נקודות.
- [x] **שדרוגים > יעדים: יעד לפי מקסימום נקודות** – יעד מוחלט דינמי שמבוסס על התקרה המחושבת.

### חדש (ינואר 2026) – דרישות לקוח נוספות
- [ ] **הדפסה בעמדת קופה:**
  - [ ] להחזיר לוגו בשוברים
  - [ ] להדפיס שובר גם על מוצרים/וריאציות
  - [ ] להסיר הדגשת תאריך עברי (רק להציג תאריך עברי)
  - [ ] לתקן סוגריים הפוכים ב"משך (דקות)"
  - [ ] להגדיל את שם המוצר/אתגר בשובר
- [x] **עמדת קופה:** החלקת כרטיס מאסטר 1 לפתיחת חלון "יציאה"/"הגדרות" + בחירת בסיס נתונים לשיוך העמדה
- [x] **עדכון גרסה:** לבדוק העתקת תיקיית sound למיקום המשותף בזמן עדכון
- [x] **חלון חסימות ספאם:** להוסיף כפתורי הוספת קודים ({מס' תיקופים}/{timeleft}) לטקסט
- [x] **שדרוגים > צבעים וצלילים:** תיקון שמירה של עריכת שורה קיימת ללא הוספה/מחיקה
- [x] **בחירת צליל:** להוסיף אפשרות "ללא צליל" בכל הרשימות (שדרוגים/אירועים/חסימות)
- [x] **פרסומות:** להסתיר פרסומת גם בעת בונוס מורה/בונוסים נוספים (לא רק תיקוף רגיל)
- [x] **עדכונים אוטומטיים:** בבדיקת עדכון בהפעלה – להוריד אוטומטית גרסה חדשה אם קיימת, כולל תמיכה בקובץ manifest בגוגל דרייב
- [x] **גרסה בקובץ התקנה:** לכלול מספר גרסה בשם קובץ ההתקנה וגם בפרטי "תוכניות ותכונות" בוינדוס
- [ ] **שדרוג מדורג למצב מקוון/היברידי:** תכנון מסלול שדרוג כך שמי שלא מפעיל מוד מקוון ימשיך לעבוד ללא שינוי

### מצב מקוון/היברידי (Hybrid / Cloud) – קריטי
- [x] **ענן: endpoint Snapshot** – הוספת `/sync/snapshot` להעלאת teachers+students ל-tenant DB בענן (bootstrap)
- [x] **מקומי: snapshot upload** – הרחבת `sync_agent.py` עם `--snapshot` לשליחת teachers+students לענן
- [x] **DB Persistency** – מעבר למסד נתונים מנוהל (Postgres) כדי שלא יאבד מידע ב-redeploy
- [x] **Postgres: Multi-tenant** – נתוני tenant נשמרים ב-Postgres (schema לכל tenant) במקום קבצי `.db`
- [x] **Debug Sync Agent** – הוספת מצבי דיבאג להצגת change_log (`--show-pending`, `--show-all-changes`)
- [x] **בדיקת קבלה (Acceptance)** – snapshot OK ואז `--once` משנה נקודות ונראה באתר, ואז redeploy והנתונים נשמרים
- [ ] **בהתחברות ראשונה:** לשאול "לעדכן נתונים בענן?" + בדיקת סטטוס מי יותר מעודכן (local vs cloud)
- [ ] **סנכרון רציף:** לאחר snapshot – סנכרון פעולות באופן קבוע (לא "מצב")
- [ ] **אידמפוטנטיות:** מנגנון `op_id`/`event_id` כך שפעולה שנשלחה פעמיים לא תכפיל נקודות
- [ ] **התנגשויות:** מסך השוואה + יומן פעולות + בחירה מה לשמור כשיש חוסר התאמה
- [ ] **Deploy לענן:** commit+push + redeploy ב-DigitalOcean כדי שכל זה יעבוד בפרודקשן

#### Hybrid UX (ללא פקודות ידניות)
- [x] **אוטומציה ברמת לקוח (בשלב ראשון)** – עמדת ניהול מפעילה `sync_agent` בלולאה ברקע כשמצב הוא hybrid/cloud ויש פרטי סנכרון
- [ ] **אוטומציה מלאה** – Windows Task Scheduler / שירות לכל העמדות (כולל public/cashier)
- [ ] **ריצת רקע בטוחה** – backoff בשגיאות רשת + הגבלת תדירות + לוג קצר
- [ ] **חיבור אוטומטי לסנכרון מתוך התוכנה** – הפעלה/עצירה מתוך GUI לפי מצב (local/hybrid/cloud)

### Web UI (אתר) – חובה
- [ ] **הדר אחיד בכל הדפים** – הדר דומה לדף הבית עם כפתור "בית"/"אחורה" בכל דף (כולל מדריך וצור קשר)
- [ ] **אזור אישי בהדר** – לפני התחברות: "התחברות"; אחרי התחברות: שם/קוד מוסד + כניסה לתפריט מוסד
  - [ ] החלפת סיסמה
  - [ ] שכחתי סיסמה
  - [ ] פרטי רישום ותשלומים
  - [ ] פרטים נוספים
- [ ] **מדריך: תיקוני RTL/תצוגה** – להסיר עיגולים/אלמנטים מיותרים ולוודא תמונות תקינות
- [ ] **מדריך: לוודא גרסה עדכנית** – להשוות ל-`C:\ProgramData\SchoolPoints\guide_user_embedded.html` ולהעלות לגרסת האתר
- [ ] **מדריך: תמונות לא נטענות** – למפות src של התמונות ב-HTML ולוודא הגשה נכונה בשרת (`/web/assets/...` או rewrite)
- [ ] **צור קשר: טופס אמיתי** – שם, מייל, נושא, הודעה, שליחה ל-`info.schoolpoints@gmail.com` (לפחות שמירה במסד + אופציה שליחה במייל)
- [ ] **תפריט תמחור** – תשתית לדף Pricing
- [ ] **רישום מקוון + סליקה** – תשתית לרישום מוסד/רישוי מקוון, תשלום בכרטיס אשראי, התאמת מחולל רשיונות

### Web Admin (עמדת ניהול ווב)
- [ ] **טבלת תלמידים מלאה** – עמודות זהות לממשק המקומי: מס' סידורי, משפחה, פרטי, כיתה, נקודות, הודעה פרטית, וכל שאר הפרטים
  - [ ] בחירת שורה
  - [ ] עריכה ישירה במקום
  - [ ] לא לחסר מאומה ביחס לממשק המקומי

#### מורים (Web)
- [x] **מסך ניהול מורים** – רשימה + חיפוש + CRUD בסיסי + API (`/web/teachers`, `/api/teachers*`)
- [x] **יישור קו מלא לממשק המקומי** – הרשאות/כיתות למורה/הגבלות בונוסים/שדות נוספים

#### מסכים נדרשים (אין עדיפות – כולם קריטיים)
- [x] **שדרוגים** – מלא
- [x] **הודעות** – מלא
  - [x] יצירת טבלאות הודעות ב-tenant DB (static/threshold/news/ads/student)
  - [x] API מלא לניהול הודעות + פרסומות (CRUD/תזמון/סידור/העלאת תמונה)
  - [x] UI מלא למסך הודעות בווב (טאבים, טבלאות, פעולות כמו במקומי)
- [x] **בונוסים** – מלא
- [x] **בונוס מיוחד** – מלא
- [x] **בונוס זמנים** – מלא
- [x] **חגים/חופשות** – מלא
- [x] **הגדרות מערכת** – מלא
- [x] **הגדרות תצוגה** – מלא
- [x] **קופה** – מלא
- [x] **דוחות** – מלא
- [x] **לוגים** – מלא

#### Pairing / חיבור אוטומטי (כמו OAuth Device Code)
- [ ] **יצירת מוסד באתר** – הזנת נתונים + יצירת tenant_id + password + api_key
- [x] **קוד התאמה (device code)** – השרת מנפיק `device_code/user_code`
- [x] **מסך אישור באתר** – הזנת `user_code` ואישור למכשיר
- [ ] **Poll מהתוכנה** – התוכנה מקבלת `tenant_id/api_key/sync_url` אחרי אישור
- [ ] **כתיבה אוטומטית ל-config.json** – עדכון פרטי חיבור בלי הקלדה ידנית
- [ ] **הסתרת פרטי חיבור בממשק המקומי** – אין שדות API Key/URL, רק כפתור התחבר/התנתק

#### Onboarding לענן בלבד
- [ ] **מורה ראשון** – יצירת קוד/סיסמת מורה ראשונית בעת פתיחת מוסד חדש בענן (כדי לאפשר כניסה ראשונה)

### 1. השלמת רישיון חודשי
**קבצים:** `admin_station.py`, `license_manager.py`

- [x] עדכון דיאלוג רישום רישיון:
  - [x] הוספת רדיו בטון "רישיון חודשי"
  - [x] שדה בחירת תאריך תפוגה (DatePicker או Entry)
  - [x] כפתור "צור קוד רישיון חודשי"
  - [x] הצגת הקוד שנוצר
  
- [ ] בדיקת תוקף רישיון חודשי:
  - [ ] בדיקה בהפעלת המערכת
  - [ ] השוואת `expiry_date` לתאריך נוכחי
  - [ ] הצגת אזהרה X ימים לפני תפוגה
  - [ ] חסימת גישה לאחר תפוגה
  
- [x] עדכון `LicenseManager`:
  - [x] הוספת `is_monthly` property
  - [x] הוספת `days_until_expiry()` method
  - [x] הוספת `is_expired()` method לרישיון חודשי
  - [x] עדכון `can_run_*()` methods לבדוק תוקף חודשי

### 2. חסימת תיקופים לחינם
**קבצים:** `database.py`, `admin_station.py`, `public_station.py`

- [x] הוספת שדה `is_free_fix_blocked` לטבלת students
- [x] הוספת checkbox בממשק הניהול לחסימת תיקופים חינם לתלמיד
- [x] בדיקה בעמדה הציבורית - אם חסום, לא לאפשר תיקוף חינם
- [x] הצגת הודעה מתאימה לתלמיד שחסום
- [x] אפשרות לביטול חסימה ע"י מנהל

### 3. אייקונים ועיצוב
**קבצים:** קבצי `.ico`, `.spec`, `.iss`

- [x] עיצוב סט אייקונים מותאם:
  - [x] אייקון עמדת ניהול (Admin) - כוכב/מנהל
  - [x] אייקון עמדה ציבורית (Public) - תלמיד/משתמש
  - [x] אייקון עמדת קופה (Cashier) - עגלת קניות/מטבע
  - [x] אייקון מתקין (Installer) - לוגו ראשי
  
- [x] יצירת קבצי `.ico` בגדלים שונים:
  - [x] 16x16, 32x32, 48x48, 64x64, 128x128, 256x256
  
- [x] עדכון קבצי `.spec`:
  - [x] `SchoolPoints_Admin.spec` - icon='icons/admin.ico'
  - [x] `SchoolPoints_Public.spec` - icon='icons/public.ico'
  - [x] `SchoolPoints_Cashier.spec` - icon='icons/cashier.ico'
  
- [x] עדכון `SchoolPoints_Installer.iss`:
  - [x] SetupIconFile - אייקון המתקין
  - [x] UninstallDisplayIcon - אייקון הסרת התקנה
  - [x] קיצורי דרך לשולחן העבודה עם אייקונים
  - [x] קיצורי דרך לתפריט התחל

### 3. תיקון build_full.bat
- [x] שיפור טיפול בשגיאות pip install
- [x] הוספת timeout ארוך יותר (60-120 שניות)
- [x] הסרת --only-binary שגורם לבעיות
- [x] הוספת ניסיון חוזר אוטומטי
- [x] הוספת הדפסות ברורות יותר

---

## מטלות עתידיות - עדיפות בינונית 🟡

### שיפורי מערכת רישוי
- [ ] מחולל קודי רישיון חודשי אוטומטי (כלי למנהל)
- [ ] מעקב אחר היסטוריית רישיונות
- [ ] התראות מייל לפני תפוגת רישיון
- [ ] פאנל ניהול רישיונות מרכזי

### שיפורי ייצוא ודוחות
- [ ] ייצוא לפורמטים נוספים (PDF, CSV)
- [ ] תבניות דוחות מותאמות אישית
- [ ] גרפים וויזואליזציות
- [ ] שליחת דוחות במייל אוטומטית

### שיפורי ממשק משתמש
- [ ] ערכת נושא כהה (Dark Mode)
- [ ] גדלי גופן מותאמים אישית
- [ ] קיצורי מקלדת נוספים
- [ ] סרגל כלים מהיר

---

## רעיונות לטווח ארוך 💡

### אינטגרציות
- [ ] סנכרון עם Google Sheets
- [ ] אינטגרציה עם מערכת הודעות SMS
- [ ] חיבור למערכת ניהול בית ספר קיימת
- [ ] API לגישה חיצונית

### פיצ'רים מתקדמים
- [ ] גיבוי אוטומטי לענן
- [ ] אפליקציית מובייל (תצוגה בלבד)
- [ ] מצב רב-משתמשים עם הרשאות
- [ ] מערכת התראות מתקדמת
- [ ] דשבורד אנליטיקס

---

## הערות טכניות 📝

### קבצים עיקריים במערכת
```
SchoolPoints/
├── admin_station.py          # עמדת ניהול ראשית
├── public_station.py          # עמדה ציבורית לתלמידים
├── cashier_station.py         # עמדת קופה
├── database.py                # ניהול מסד נתונים
├── license_manager.py         # מערכת רישוי
├── messages.py                # מערכת הודעות וחדשות
├── messages_manager.py        # ממשק ניהול הודעות
├── excel_import.py            # ייבוא/ייצוא Excel
├── excel_styling.py           # עיצוב קבצי Excel (RTL, צבעים)
├── jewish_calendar.py         # לוח עברי
└── TODO.md                    # קובץ זה
```

### פורמטים וסטנדרטים
- **תאריכים במסד נתונים:** `YYYY-MM-DD` (ISO 8601)
- **תאריכים בממשק משתמש:** `DD.MM.YYYY` (פורמט ישראלי)
- **קודי רישיון:** `XXXXX-XXXXX-XXXXX-XXXXX` (20 תווים, 4 קבוצות)
- **סכמות רישיון:**
  - SP1: רישיון ישן (ללא קוד מערכת)
  - SP2: רישיון חדש (עם קוד מערכת)
  - SP3: רישיון חודשי (עם תאריך תפוגה)

### רמות רישיון
- **Trial:** 7 ימי ניסיון, 2 תחנות
- **Basic:** 2 תחנות
- **Extended:** 5 תחנות
- **Unlimited:** 999 תחנות
- **Monthly:** כל הרמות לעיל, עם תאריך תפוגה

### משתני סביבה חשובים
- `TRIAL_DAYS = 7` - מספר ימי ניסיון
- `APP_VERSION = "1.4.2"` - גרסת האפליקציה
- `ENABLE_PURCHASES` - דגל להפעלת מערכת הקופה

---

## תהליך עבודה מומלץ 

1. **לפני תחילת עבודה:**
   - עדכן קובץ זה עם המטלה החדשה
   - סמן מטלות קיימות כ-"בתהליך"
   

2. **במהלך העבודה:**
   - עדכן סטטוס מטלות שהושלמו
   - הוסף הערות טכניות רלוונטיות
   - תעד שינויים משמעותיים

3. **בסיום עבודה:**
   - סמן מטלות שהושלמו ✅
   - הוסף תאריך עדכון
   - בדוק אם יש מטלות נגררות

---

**עדכון אחרון:** 27/01/2026  
**מטלה נוכחית:** מצב מקוון/היברידי – סנכרון (Snapshot + פעולות)  
**הבא בתור:** Deploy לענן + הוספת אידמפוטנטיות והתנגשויות
